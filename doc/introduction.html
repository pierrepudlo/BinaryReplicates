<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Get started with BinaryReplicates</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Get started with BinaryReplicates</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(BinaryReplicates)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.5</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#&gt; ✔ ggplot2   3.5.1     ✔ tibble    3.2.1</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt; ✔ lubridate 1.9.3     ✔ tidyr     1.3.1</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt; ✔ purrr     1.0.2     </span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span></code></pre></div>
<p>introduction.R</p>
<p>The <code>BinaryReplicates</code> package provides tools for the
analysis of binary replicates. The aim of this vignette is to provide a
quick overview of the main functions of the package.</p>
<div id="the-statistical-model" class="section level1">
<h1>The statistical model</h1>
<p>For each individual <span class="math inline">\(i\)</span> in the
dataset, we observe <span class="math inline">\(n_i\)</span> replicates,
each taking the value <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>. These replicates are noisy
measurements of the true latent state <span class="math inline">\(T_i\)</span>, which is also binary. We denote
<span class="math inline">\(S_i\)</span> the number of replicates equal
to <span class="math inline">\(1\)</span> for individual <span class="math inline">\(i\)</span>. The probability of observing a <span class="math inline">\(1\)</span> is <span class="math inline">\(1-q\)</span> if <span class="math inline">\(T_i =
1\)</span> and <span class="math inline">\(p\)</span> if <span class="math inline">\(T_i = 0\)</span>. Thus,</p>
<ul>
<li><span class="math inline">\(S_i\)</span> is the number of replicates
equal to <span class="math inline">\(1\)</span> for individual <span class="math inline">\(i\)</span>,</li>
<li><span class="math inline">\(p\)</span> is the false-positivity
rate,</li>
<li><span class="math inline">\(q\)</span> is the false-negativity
rate.</li>
</ul>
<p>We assume that the individuals are independent and identically
distributed. The prevalence of state <span class="math inline">\(1\)</span> in the population is <span class="math inline">\(\theta_T = P(T_i = 1)\)</span>.</p>
<p>The <strong>statistical model</strong> is thus <span class="math display">\[
[T_i|\theta_T]\sim \text{Bernoulli}(\theta_T),\quad [S_i|T_i, p, q]\sim
\text{Binomial}\big(n_i, T_i(1-q)+(1-T_i)p\big).
\]</span></p>
<p>In the Bayesian paradigm, we need to set a prior on the fixed
parameters: <span class="math inline">\(\theta_T\in(0,1)\)</span>, <span class="math inline">\(p\in(0,1/2)\)</span> and <span class="math inline">\(q\in(0,1/2)\)</span>. Under the <strong>prior
distribution</strong>, the three parameters are independent:</p>
<ul>
<li><span class="math inline">\(\theta_T \sim \text{Beta}(a_T,
b_T)\)</span>,</li>
<li><span class="math inline">\(p \sim \text{Beta}(a_{FP},
b_{FP})\)</span> constrained on <span class="math inline">\((0,
1/2)\)</span> and</li>
<li><span class="math inline">\(q \sim \text{Beta}(a_{FN},
b_{FN})\)</span> constrained on <span class="math inline">\((0,
1/2)\)</span>.</li>
</ul>
<p>Hyperparameters <span class="math inline">\(a_T, b_T, a_{FP}, b_{FP},
a_{FN}, b_{FN}\)</span> are set by the user to include external
information in the analysis. In absence of prior information, we
recommend <span class="math display">\[
a_T = b_T = 1/2;\quad a_{FP} = b_{FP} = a_{FN} = b_{FN} = 2.
\]</span></p>
<p>We rely on <a href="https://mc-stan.org/">Stan</a> to sample from the
posterior distribution of the fixed parameters and the latent
variables.</p>
</div>
<div id="examples-on-how-to-use-the-package" class="section level1">
<h1>Examples on how to use the package</h1>
<div id="generate-synthetic-data" class="section level2">
<h2>Generate synthetic data</h2>
<p>We start by generating a synthetic dataset according to the
model:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>theta <span class="ot">&lt;-</span> .<span class="dv">4</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>p <span class="ot">&lt;-</span> q <span class="ot">&lt;-</span> .<span class="dv">22</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>ni <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>ti <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, theta)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>si <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, ni, ti<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>q) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>ti)<span class="sc">*</span>p)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ni =</span> ni, <span class="at">si =</span> si, <span class="at">ti=</span>ti)</span></code></pre></div>
<p>introduction.R</p>
<p>We will use this dataset to illustrate the main functions of the
package.</p>
</div>
<div id="scoring-the-individuals" class="section level2">
<h2>Scoring the individuals</h2>
<p>We provide various ways to score an individual of the dataset: each
score is a number between <span class="math inline">\(0\)</span> and
<span class="math inline">\(1\)</span>. Higher values of the score
indicate a higher probability of being in state <span class="math inline">\(1\)</span>. The scoring methods are :</p>
<ul>
<li>the average or the median of the replicates of this individual,</li>
<li>a likelihood based score that requires estimates of <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, and <span class="math inline">\(\theta_T\)</span> and</li>
<li>the posterior probability of being in state <span class="math inline">\(1\)</span>.</li>
</ul>
<p>Before computing the scores, we need to sample from the posterior
distribution. With the default prior, this is done as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">BayesianFit</span>(ni, si, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">5000</span>, <span class="at">refresh =</span> <span class="dv">0</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">print</span>(fit, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;theta&quot;</span>, <span class="st">&quot;p&quot;</span>, <span class="st">&quot;q&quot;</span>))</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; Inference for Stan model: BayesianModel.</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; 4 chains, each with iter=5000; warmup=2500; thin=1; </span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; post-warmup draws per chain=2500, total post-warmup draws=10000.</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt;       mean se_mean   sd 2.5%  25%  50%  75% 97.5% n_eff Rhat</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; theta 0.49       0 0.13 0.24 0.40 0.49 0.58  0.74  3912    1</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; p     0.22       0 0.07 0.10 0.18 0.22 0.27  0.37  3868    1</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; q     0.25       0 0.08 0.10 0.20 0.25 0.30  0.40  4196    1</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Mon Jul 22 11:18:19 2024.</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; convergence, Rhat=1).</span></span></code></pre></div>
<p>introduction.R</p>
<p>We can now add the scores to the dataset:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> synth_data <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y_A =</span> <span class="fu">average_scoring</span>(ni, si),</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>         <span class="at">Y_M =</span> <span class="fu">median_scoring</span>(ni, si),</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>         <span class="at">Y_L =</span> <span class="fu">likelihood_scoring</span>(ni, si, theta, p, q),</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>         <span class="at">Y_B =</span> <span class="fu">bayesian_scoring</span>(ni, si, fit))</span></code></pre></div>
<p>introduction.R</p>
<p>Note that we have plugged in the true values of the parameters in the
likelihood scoring function. In practice, we would use the estimates
obtained from other methods, like the Bayesian fit.</p>
</div>
<div id="predicting-the-latent-states" class="section level2">
<h2>Predicting the latent states</h2>
<p>The latent state of an individual is either <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>. But since binary replicates are noisy
measurements, we allow three different values for the prediction:</p>
<ul>
<li><span class="math inline">\(0\)</span> if the score is lower than a
threshold <span class="math inline">\(v_L\)</span></li>
<li><span class="math inline">\(1\)</span> if the score is higher than a
threshold <span class="math inline">\(v_U\)</span></li>
<li><span class="math inline">\(1/2\)</span> otherwise, which means that
we are uncertain about the prediction. This is an inconclusive decision
that appeals for more data to conclude.</li>
</ul>
<p>We can compute the predictions for the synthetic dataset as
follows:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>v_L <span class="ot">&lt;-</span> .<span class="dv">35</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>v_U <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> v_L</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> synth_data <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">T_A =</span> <span class="fu">classify_with_scores</span>(Y_A, v_L, v_U),</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>         <span class="at">T_M =</span> <span class="fu">classify_with_scores</span>(Y_M, v_L, v_U),</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>         <span class="at">T_L =</span> <span class="fu">classify_with_scores</span>(Y_L, v_L, v_U),</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>         <span class="at">T_B =</span> <span class="fu">classify_with_scores</span>(Y_B, v_L, v_U))</span></code></pre></div>
<p>introduction.R</p>
<p>We can now count how many times we decide in favor of <span class="math inline">\(0\)</span>, <span class="math inline">\(1\)</span>
or <span class="math inline">\(1/2\)</span> (inconclusive) given the
true state and the method to score the individuals as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>confusion <span class="ot">&lt;-</span> synth_data <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="at">Status =</span> <span class="fu">ifelse</span>(ti<span class="sc">==</span><span class="dv">1</span>, <span class="st">&quot;T=1&quot;</span>, <span class="st">&quot;T=0&quot;</span>),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="at">Averge =</span> T_A, <span class="at">Median =</span> T_M, <span class="at">Likelihood =</span> T_L, <span class="at">Bayesian =</span> T_B) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Averge, Median, Likelihood, Bayesian), </span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;Method&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Decision&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="fu">group_by</span>(Status, Method, Decision) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">&quot;keep&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">as.integer</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Decision, <span class="at">values_from =</span> count, <span class="at">values_fill =</span> <span class="dv">0</span>) </span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>confusion</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; # A tibble: 8 × 5</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt;   Status Method       `0` `0.5`   `1`</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 1 T=0    Averge        22     8     2</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; 2 T=0    Bayesian      22     7     3</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; 3 T=0    Likelihood    22     7     3</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; 4 T=0    Median        22     7     3</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; 5 T=1    Averge         0     2    16</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; 6 T=1    Bayesian       1     0    17</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt; 7 T=1    Likelihood     1     0    17</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; 8 T=1    Median         1     0    17</span></span></code></pre></div>
<p>introduction.R</p>
</div>
<div id="predicting-scores-on-new-data-and-classify-them" class="section level2">
<h2>Predicting scores on new data and classify them</h2>
<p>Based on the Bayesian fitting, we can also compute the Bayesian
scores and the predictions on new data. Let us say we are interrested in
predicting the scores and the latent state of individuals with <span class="math inline">\(n_i = 8\)</span> replicates and <span class="math inline">\(s_i \in \{0, 1, 2, 3, 4, 5, 6, 7, 8\}\)</span>.
The new data are thus:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ni =</span> <span class="fu">rep</span>(<span class="dv">8</span>, <span class="dv">9</span>), <span class="at">si =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">8</span>)</span></code></pre></div>
<p>introduction.R</p>
<p>The scores and the predictions can be computed as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> new_data <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y_B =</span> <span class="fu">predict_scores</span>(ni, si, fit),</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>         <span class="at">T_B =</span> <span class="fu">classify_with_scores</span>(Y_B, v_L, v_U))</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>new_data</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;   ni si         Y_B T_B</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; 1  8  0 0.001056828 0.0</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; 2  8  1 0.006747601 0.0</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; 3  8  2 0.045135972 0.0</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; 4  8  3 0.213009366 0.0</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; 5  8  4 0.549793089 0.5</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; 6  8  5 0.843224587 1.0</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; 7  8  6 0.966987093 1.0</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; 8  8  7 0.995365411 1.0</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; 9  8  8 0.999283495 1.0</span></span></code></pre></div>
<p>introduction.R</p>
<p>In the above situation, the predictions are conclusive for all the
individuals except the one where we observed as many <span class="math inline">\(0\)</span>’s as <span class="math inline">\(1\)</span>’s in the replicates.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
